<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçÑ Fungi Global Quiz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        /* Style sama seperti sebelumnya, saya ringkas agar fokus ke sistem baru */
        :root { --primary: #6c5ce7; --bg: #dfe6e9; --success: #00b894; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); width: 100%; max-width: 500px; }
        .option-btn { width: 100%; padding: 15px; margin: 5px 0; border: 2px solid #eee; border-radius: 12px; cursor: pointer; text-align: left; transition: 0.2s; }
        .option-btn:hover { background: #f9f9ff; border-color: var(--primary); }
        .correct { background: var(--success) !important; color: white; }
        .wrong { background: #d63031 !important; color: white; }
        .hidden { display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
        .loader { text-align: center; color: var(--primary); font-style: italic; }
    </style>
</head>
<body>

<div class="container animate__animated animate__fadeIn">
    <div id="quiz-ui">
        <h2 id="question">Memuat soal...</h2>
        <div id="options"></div>
    </div>

    <div id="result-ui" class="hidden animate__animated animate__zoomIn">
        <h1>üéâ Kuis Selesai!</h1>
        <h3>Skor: <span id="final-score">0</span></h3>
        <input type="text" id="username" placeholder="Nama kamu..." style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid #ccc;">
        <button id="save-btn" onclick="uploadScore()" style="width:100%; padding:15px; background:var(--primary); color:white; border:none; border-radius:12px; cursor:pointer;">Kirim ke Leaderboard Global</button>
    </div>

    <hr style="margin: 30px 0;">
    
    <h3>üèÜ Leaderboard Global (Live)</h3>
    <div id="loading-lb" class="loader">Menghubungkan ke satelit...</div>
    <table>
        <thead><tr><th>Peringkat</th><th>Nama</th><th>Skor</th></tr></thead>
        <tbody id="lb-body"></tbody>
    </table>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, set, push, onValue, query, orderByChild, limitToLast } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  // --- GANTI DENGAN CONFIG PUNYAMU SENDIRI ---
  const firebaseConfig = {
    apiKey: "AIzaSyA_8JCXQ9TzLhjQc6fKlymSWfMz7mwf5qU",
  authDomain: "kuisfungi.firebaseapp.com",
  projectId: "kuisfungi",
  storageBucket: "kuisfungi.firebasestorage.app",
  messagingSenderId: "91694372438",
  appId: "1:91694372438:web:64322d372b5eca4e32cdf7",
  measurementId: "G-5EV72F33P3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // --- LOGIKA KUIS ---
  const questions = [
      { q: "Hifa yang tidak memiliki sekat disebut?", a: ["Septat", "Senositik", "Miselium"], c: 1 },
      { q: "Jamur tempe adalah?", a: ["Rhizopus", "Aspergillus", "Penicillium"], c: 0 },
      { q: "Dinding sel jamur dari?", a: ["Selulosa", "Kitin", "Peptidoglikan"], c: 1 }
  ];

  let currentIdx = 0;
  let score = 0;

  window.handleAnswer = (idx, btn) => {
      if(idx === questions[currentIdx].c) {
          score += 33; // Sesuaikan pembagian skor
          btn.classList.add('correct');
      } else {
          btn.classList.add('wrong');
      }
      setTimeout(nextQuestion, 1000);
  };

  function showQuestion() {
      const q = questions[currentIdx];
      document.getElementById('question').innerText = q.q;
      document.getElementById('options').innerHTML = q.a.map((opt, i) => 
          `<button class="option-btn" onclick="handleAnswer(${i}, this)">${opt}</button>`
      ).join('');
  }

  function nextQuestion() {
      currentIdx++;
      if(currentIdx < questions.length) {
          showQuestion();
      } else {
          document.getElementById('quiz-ui').classList.add('hidden');
          document.getElementById('result-ui').classList.remove('hidden');
          document.getElementById('final-score').innerText = score;
      }
  }

  // --- LOGIKA FIREBASE (LEADERBOARD GLOBAL) ---
  window.uploadScore = async () => {
    const nameInput = document.getElementById('username');
    const name = nameInput.value.trim() || "Anon";
    const saveBtn = document.getElementById('save-btn');

    // Beri tanda kalau proses sedang berjalan
    saveBtn.innerText = "Sedang Mengirim...";
    saveBtn.disabled = true;

    try {
        const scoresRef = ref(db, 'leaderboard');
        const newScoreRef = push(scoresRef);
        
        await set(newScoreRef, {
            username: name,
            score: score,
            timestamp: Date.now()
        });

        alert("‚úÖ Skor " + score + " berhasil dikirim!");
        saveBtn.innerText = "Terkirim!";
    } catch (error) {
        console.error(error);
        alert("‚ùå Gagal kirim! Penyebab: " + error.message);
        saveBtn.disabled = false;
        saveBtn.innerText = "Coba Kirim Lagi";
    }
};

  // Ambil Data Realtime
  const lbRef = query(ref(db, 'leaderboard'), orderByChild('score'), limitToLast(10));
  onValue(lbRef, (snapshot) => {
      const data = snapshot.val();
      const lbBody = document.getElementById('lb-body');
      document.getElementById('loading-lb').classList.add('hidden');
      
      let items = [];
      for (let id in data) items.push(data[id]);
      
      // Urutkan dari tertinggi
      items.sort((a, b) => b.score - a.score);
      
      lbBody.innerHTML = items.map((item, index) => `
          <tr>
              <td>#${index + 1}</td>
              <td>${item.username}</td>
              <td>${item.score}</td>
          </tr>
      `).join('');
  });

  showQuestion();
</script>

</body>
</html>

